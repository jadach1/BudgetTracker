<script>

  // Display CHANGE Month Form, event Listener
  document.getElementById("changeMonthFormButton").addEventListener("click", () => {

    let changeMonthExpensesForm = document.getElementById("changeMonthForm")
    changeMonthExpensesForm.hidden = false;
    changeMonthExpensesForm.classList.add("d-flex");

    //Alter position of form
    alterPositionChangeMonthForm();

    //disable buttons
    disableEnableAllButtons(true);
  });


  // Display Expense Form, event Listener
  createEditExpensesFormButton = document.getElementById("createEditExpensesFormButton").addEventListener("click", () => {

    let createEditExpensesForm = document.getElementById("createEditExpensesForm")
    createEditExpensesForm.hidden = false;
    createEditExpensesForm.classList.add("d-flex");

    //Alter position of form
    alterPosition("createEditExpensesForm");

    //disable buttons
    disableEnableAllButtons(true);
  });

  // Hide-Box for the create-expense-form and change-month-form
  document.getElementById("expense-form-hide-button").addEventListener("click", () => {
    let createEditExpensesForm = document.getElementById("createEditExpensesForm");
    createEditExpensesForm.classList.remove("d-flex");
    createEditExpensesForm.hidden = true;
    let changeMonthExpensesForm = document.getElementById("changeMonthForm")
    changeMonthExpensesForm.classList.remove("d-flex");
    changeMonthExpensesForm.hidden = true;
    disableEnableAllButtons(false);
  })

  // Hide-Box for the create-expense-form and change-month-form
  document.getElementById("change-month-hide-button").addEventListener("click", () => {
    let changeMonthExpensesForm = document.getElementById("changeMonthForm")
    changeMonthExpensesForm.classList.remove("d-flex");
    changeMonthExpensesForm.hidden = true;
    disableEnableAllButtons(false);
  })

</script>

<!-- FUNCTIONS VISIBILITY-->
<script>
  function disableEnableAllButtons(flag = true) {
    document.getElementById("createEditExpensesFormButton").disabled = flag;
    document.getElementById("createExpenseStagingArea").disabled = flag;
    document.getElementById("changeMonthFormButton").disabled = flag;
  }

  //alters the left-position of the Create Expense Form
  function alterPosition(name, comparingHeight = 0) {
   
    // this will get the element based on the string of the modalType
    let bodyToChange = document.getElementById(name);

    const bodySize = +document.getElementsByTagName('body')[0].clientWidth;
    const bodyHeight = +window.innerHeight;

    //adjust the height-position
    let height = (bodyHeight - +bodyToChange.clientHeight) / 2;

    if (height < 0)
      height = 0;

    bodyToChange.style.top = height + "px";

    // Adjust the width-position
    let size = (bodySize - +bodyToChange.clientWidth) / 2

    if (size < 0)
      size = 0;

    bodyToChange.style.left = size + "px";

    //Lastly, adjust the height of the element, if a parameter has been added.
    @* if(comparingHeight != 0)
      bodyToChange.style.height = comparingHeight+"px"; *@
  }

  //Alter position of the change-month-form
  function alterPositionChangeMonthForm() {
    const bodySize = +document.getElementsByTagName('body')[0].clientWidth;
    const bodyHeight = +window.innerHeight;
    let changeMonthExpensesForm = document.getElementById("changeMonthForm")

    //adjust the height-position
    let height = (bodyHeight - +changeMonthExpensesForm.clientHeight) / 2;

    if (height < 0)
      height = 0;

    changeMonthExpensesForm.style.top = height + "px";

    // Adjust the width-position
    let size = (bodySize - +changeMonthExpensesForm.clientWidth) / 2

    if (size < 0)
      size = 0;
    changeMonthExpensesForm.style.left = size + "px";
  }

  //hides or displays a table - table is located in the expensesTables.cshtml
  function HideOrDisplayExpenseTable(start, stop) {
    $('tr.' + start).nextUntil('tr.' + stop).slideToggle(500);
  }
</script>

<!-- FUNCTIONS EDIT MODAL-->
<script>
  
  // When clicking on the icons on the expense table 
  function toggle_edit_delete_expense(id,flag=true,tr_expense_id)
  {
    @* let colorFlag = flag ? "white" : "aqua";
    let nodes = document.getElementById("expense"+id).getElementsByTagName("td");
    for(let i = 0; i < nodes.length; i++){
      nodes[i].style.color = colorFlag;
    }    
    let icon_row = document.getElementById("expense_table_edit_and_delete_elements_"+id);
    icon_row.hidden = flag;
    icon_row.style.display = flag ? "none" : "flex"; *@

    const $Table_Selected_Row = $(tr_expense_id);
    const $Expense_Table_Modal = $("#expense_table_modal");
    const whoIsYourDaddy = $Expense_Table_Modal.parent()[0].tagName;

    const $Expense_Table_Modal_Edit_Button = $("#expense_table_modal a").first();
    const $Expense_Table_Modal_Delete_Button = $("#expense_table_modal a").eq(1);
    const $Expense_Table_Modal_Hide_Button = $("#expense_table_modal a").eq(2);

    if(whoIsYourDaddy === "TR"){
      //we need to remove the class from the parent and apply it to the new TR class
      const $Daddy = $Expense_Table_Modal.parent();
      $Daddy.removeClass("row-highlight-selected");
    } 

      $Table_Selected_Row.addClass("row-highlight-selected");

      //Adjust size of modal to screen
      $Expense_Table_Modal.css({
          display: "flex",
      });

    //Clear the old click handlers
    $Expense_Table_Modal_Edit_Button.off('click');
    //Assign the click events, once
    $Expense_Table_Modal_Edit_Button.on("click",function(){
        //To Edit, ajax call to fetch expense, then load modal by way of ajax method success path.
        ajaxCallToExpenseController_GetExpense(id)
        //Hide this modal, its job is done
        hide_Expense_Table_Modal($Expense_Table_Modal,$Table_Selected_Row);
      });
    
    $Table_Selected_Row.append($Expense_Table_Modal);
  }

//This function will grab a row from all the tables, and remove it from the DOM
function ClearExpenseFromTable(id){

}

function hide_Expense_Table_Modal($Expense_Table_Modal,$Table_Selected_Row){
  console.log("called hide")
  //Adjust size of modal to screen
      $Expense_Table_Modal.css({
          display: "none",
      });
  //Remove the class from the parent
  $Table_Selected_Row.removeClass("row-highlight-selected");
  //Detach the modal from the parent
  $Table_Selected_Row.detach($Expense_Table_Modal);
}
</script>
